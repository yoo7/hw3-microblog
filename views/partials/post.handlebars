{{! Partial for a single post }}
<div class="post">
    <div class="post-avatar">
        <!-- Conditional rendering based on variables -->
        <a href="/profile/{{this.username}}">
            <img src="{{#if this.avatar_url}}
                        {{this.avatar_url}}
                    {{else}}
                        /images/{{this.username}}
                    {{/if}}" 
                    alt="User Avatar" 
                    class="header-avatar">
        </a>
        
        
        <span class="title gaegu-regular bold">{{this.title}}</span>
    </div>
    <div class="post-content">
        <span class="content gaegu-regular">{{this.content}}</span>

        <div class="post-status-bar">
            <div class="status-buttons">
                <!-- Determine whether to show like button OR the trashcan depending on the user-->
                {{#ifCond this.username currentUser.username}}
                    <div class="delete">
                        <button type="button" data-id={{this.id}} class="trash" onclick="handleDeleteClick(event)">üóëÔ∏è</button>
                        <div class="num-likes">
                            <p>{{this.likes}} likes</p>
                        </div>
                    </div>
                {{else}}
                    <div class="likes">
                        {{#if (alreadyLiked this.likedBy this.username)}}
                            <button type="button" data-id={{this.id}} class="heart" onclick="handleLikeClick(event)">‚ô•</button>
                        {{else}}
                            <button type="button" data-id={{this.id}} class="heart" onclick="handleLikeClick(event)">‚ô°</button>
                        {{/if}}
                        
                        <div class="num-likes">
                            <p>{{this.likes}} likes</p>
                        </div>
                    </div>
                {{/ifCond}}

                <div class="keep">
                    {{#if (notFramed this)}}
                        <button type="frame" data-id={{this.id}} class="frame gaegu-regular" onclick="handleFrameClick(event)">‚óª Frame It?</button>
                    {{else}}
                        <button type="frame" data-id={{this.id}} class="frame gaegu-regular">‚ñ£ Framed!</button>
                    {{/if}}
                </div>
            </div>

            <div class="timestamp">Noted at {{formatTimestamp this.timestamp}} by {{this.username}}</div>
        </div>        
    </div>
</div>
<script>

    function handleLikeClick(event) {
        event.preventDefault();

        const postId = event.target.getAttribute("data-id");
  
        fetch("/like/" + postId, {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
            },
        })
        .then(res => res.text())
        .then(text => {
            const numLikes = parseInt(text);

            // User was logged in, so we got some # other than NaN
            // So we allow the likes to actually get updated on the DOM
            if (!isNaN(numLikes)) {
                event.target.nextElementSibling.textContent = numLikes + " likes";

                if (event.target.textContent === "‚ô•") {
                    // Unlike the post
                    event.target.textContent = "‚ô°";
                } else {
                    // Like the post
                    event.target.textContent = "‚ô•";
                }
            }
        })
        .catch(error => console.error("Error:", error));     
    }

    function handleDeleteClick(event) {
        // Climb up html hierachy to locate post html element
        // Hierarchy: button -> delete div -> post-status-bar -> post-content -> post
        const postElement = event.target.parentElement.parentElement.parentElement.parentElement;
        const postId = event.target.getAttribute("data-id");      

        fetch("/delete/" + postId, {
            method: "POST",
        })
        .catch(error => console.error('Error:', error));
        
        // Remove from DOM
        postElement.remove();
    }

    function handleFrameClick(event) {
        // Similar strategy with delete
        const button = event.target;
        const postElement = button.parentElement.parentElement.parentElement.parentElement;
        const postId = event.target.getAttribute("data-id");      

        fetch("/frame/" + postId, {
            method: "POST",
        })
        .catch(error => console.error('Error:', error));
        
        button.textContent = "‚ñ£ Framed!";
        button.removeEventListener("click", handleFrameClick);
    }
</script>